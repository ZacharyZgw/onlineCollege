<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html;">
    <meta charset="UTF-8" http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge">-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>慕课网</title>

    <#include "../common/newRes.html">
    <link href="${s.base}/res/css/amazeui.min.css" rel="stylesheet" type="text/css">
    <style type="text/css">
        .pr-50{
            padding-right: 50px;
        }
        #header{
            bottom: 16px;
        }
        .mylogo{
            margin-left: 12%;
            top: 12px;
        }
        #nav{
            top: 12px;
        }
    </style>
    <script src="${s.base}/res/js/amazeui.min.js" type="text/javascript"></script>
</head>
<body>
    <#include "../common/newHeader.html">
    <div class="userInfo_view">
        <div class="container user-container">
            <div class="clearfix">
                <div class="pull-left setting-left">
                    <div class="avator-wapper">
                        <div class="avator-mode">
                            <img class="avator-img" src='<@shiro.principal property="header"/>' width="92" height="92">
                            <div class="update-avator" style="bottom: -30px;">
                                <p><a class="js-avator-link">更换头像</a></p>
                            </div>
                        </div>
                        <div class="des-mode">
                        <p><@shiro.principal property="username"/></p>
                            <dl class="js-auth-list clearfix auth-list">
                                <dd><i class="fa fa-user-o"></i><div class="icon-tips hide" style="display: none;"><div class="triangle_border_up"><span></span></div>还未实名认证</div></dd>

                                <dd><i class="glyphicon glyphicon-education"></i><div class="icon-tips hide" style="display: none;"><div class="triangle_border_up"><span></span></div>还未学籍认证</div></dd>

                                <dd class="active"><i class="glyphicon glyphicon-phone"></i><div class="icon-tips hide" style="display: none;"><div class="triangle_border_up"><span></span></div>你已绑定手机</div></dd>
                                <dd class="active"><i class="glyphicon glyphicon-envelope"></i><div class="icon-tips hide" style="display: none;"><div class="triangle_border_up"><span></span></div>你已绑定邮箱</div></dd>
                            </dl>
                        </div>
                    </div>
                    <div class="list-wapper">
                        <h2>账户管理</h2>
                        <div class="line"></div>
                        <ul class="menu">
                            <li><a href="" class="on " style="padding-right: 50px;">账号绑定<span class="arr"><i class="glyphicon glyphicon-menu-right"></i></span></a></li>
                            <li><a href="" style="padding-right: 50px;">个人信息<span class="arr"><i class="glyphicon glyphicon-menu-right"></i></span></a></li>
                        </ul>

                    </div>
                </div>
                <div class="pull-right setting-right">
                    <div class="setting-right-wrap wrap-boxes settings">
                        <div class="page-settings">
                            <!--<div class="oplog-tip">
                                <div class="oplog-tip">
                                    上次登录时间：2018-04-18  04:11:52&nbsp;&nbsp;&nbsp;地点：百色
                                    <a href="">查看最近操作记录</a>
                                    &nbsp;&nbsp;用户ID：4014840
                                    <span class="tip-close pull-right js-tip-close">×</span>
                                </div>
                            </div>-->
                            <div class="common-title">
                                账号绑定
                                <!--<span class="title-tips">完成<b class="color-red">3/4</b></span>
                                <a href="" class="pull-right" target="_blank"><i class="glyphicon glyphicon-question-sign"></i>常见问题</a>-->
                            </div>
                            <div class="line"></div>
                            <div class="contentBox">
                                <div class="bingd">
                                    <div class="clearfix itemBox">
                                        <div class="lefts">
                                            <i class="glyphicon glyphicon-envelope" style="color: #b84c4c"></i>
                                        </div>
                                        <div class="center">
                                            <p>
                                                <span class="font1">邮箱</span>
                                                <#if user.email?? && user.email != "0">
                                                <span class="font3">${user.email}
                                                <input class="hide" id="jsMail" value="2711927321@qq.com">已绑定
                                                </span>
                                                <#else>
                                                    <span class="font4">请绑定邮箱</span>
                                                </#if>
                                                <!--<span class="font4">未验证</span>-->
                                            </p>
                                            <p class="font2">可用邮箱加密码登录慕课网，可用邮箱找回密码</p>
                                        </div>
                                        <div class="right">
                                            <#if user.email?? && user.email != "0">
                                            <a href="javascript:void(0);" id="changeemail" type="button" class="change js-change moco-btn moco-btn-normal mr12" changetype="email">更改</a>
                                            <#else>
                                            <a href="javascript:void(0);"  id="newemail" type="button" class="verify js-verify moco-btn moco-btn-normal">立即绑定</a>
                                            </#if>
                                        </div>
                                    </div>
                                    <div class="clearfix itemBox">
                                        <div class="lefts">
                                            <i class="glyphicon glyphicon-phone" style="color: #b84c4c"></i>
                                        </div>
                                        <div class="center">
                                            <p>

                                                <span class="font1">手机</span>
                                                <#if user.mobile?? && user.mobile != "">
                                                <span class="font4">${user.mobile}</span>
                                                <#else>
                                                <span class="font4">未绑定</span>
                                                </#if>
                                            </p>
                                            <p class="font2">可用手机号加密码登录慕课网，可通过手机号找回密码</p>
                                        </div>
                                        <div class="right">
                                            <#if user.mobile?? && user.mobile != "">
                                            <a href="" class="change js-change moco-btn moco-btn-normal mr12" changetype="email">更改</a>
                                            <#else>
                                            <a href="" class="change js-change moco-btn moco-btn-normal mr12" changetype="email">立即绑定</a>
                                            </#if>
                                        </div>
                                    </div>
                                    <div class="clearfix itemBox">
                                        <div class="lefts">
                                            <i class="fa fa-key" style="color: #b84c4c"></i>
                                        </div>
                                        <div class="center">
                                            <p>
                                                <span class="font1">密码 </span>
                                                <span class="font3">已设置</span>
                                            </p>
                                            <p class="font2">用于保护账号信息和登录安全</p>
                                        </div>
                                        <div class="right">
                                            <a href="" class="verify js-verify moco-btn moco-btn-normal">修改</a>
                                        </div>
                                    </div>

                                    <!--<div class="clearfix itemBox lastBox">
                                        <div class="lefts">
                                            <i class="fa fa-gg"></i>
                                        </div>
                                        <div class="center">
                                            <p>
                                                <span class="font1">社交帐号 </span>
                                            </p>
                                            <p class="font2">绑定第三方帐号，可以直接登录，还可以将内容同步到以下平台，与更多好友分享</p>
                                            <div class="clearfix accountBox">
                                                <div class="clearfix inner-i-box">
                                                    <div class="pull-left text-center icon-weixin">
                                                        <i class="fa fa-weixin"></i>
                                                    </div>

                                                    <p class="mr87 bind-name">微信</p>
                                                    <p class="mr87 red">未绑定</p>
                                                    <a href=""  class="moco-btn-normal rlf-btn-green btn js-bind mr87">添加绑定</a>
                                                </div>
                                                <div class="inner-i-box">
                                                    <div class="pull-left text-center icon-weibo">
                                                        <i class="clipboard fa fa-weibo"></i>
                                                    </div>
                                                    <p class="mr87 bind-name">微博</p>
                                                    <p class="mr87 red">未绑定</p>
                                                    <a href="" class="moco-btn-normal rlf-btn-green btn js-bind mr87">添加绑定</a>

                                                </div>
                                                <div class="inner-i-box">
                                                    <div class="pull-left text-center icon-weibo">
                                                        <i class="fa fa-qq "></i>
                                                    </div>
                                                    <p class="mr87 bind-name">QQ</p>
                                                    <p class="mr87 red">未绑定</p>
                                                    <a href=""  class="moco-btn-normal rlf-btn-green btn js-bind mr87">添加绑定</a>
                                                </div>
                                            </div>
                                        </div>

                                    </div>-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="am-modal am-modal-prompt" tabindex="-1" id="my-prompt">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">绑定邮箱</div>
            <div class="am-modal-bd">
                <form action="${s.base}/user/update" type="post" id="setEmailForm">
                <label>请输入邮箱</label>
                <input type="text" class="am-modal-prompt-input" name="email" id="setEmail">
                 <div id="errormsg" style="color: red;display: none"></div>
                </form>
            </div>
            <div class="am-modal-footer">
                <span class="am-modal-btn" data-am-modal-cancel>取消</span>
                <span class="am-modal-btn" onclick="doSubmit('setEmail');" data-am-modal-confirm  id="submit">提交</span>
            </div>
        </div>
    </div>
    <div class="am-modal am-modal-prompt" tabindex="-1" id="my-prompt1">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">绑定邮箱</div>
            <div class="am-modal-bd">
                <form action="${s.base}/user/update" type="post" id="changeEmailForm">
                    <label style="float: left;">原邮箱地址</label>
                    <input type="text" class="am-modal-prompt-input" name="email" id="oldemail" value="${user.email}" disabled="disabled">
                    <label style="float: left;">邮箱地址</label>
                    <input type="text" class="am-modal-prompt-input" name="email" id="reSetemail" value="${user.email}" >
                    <div id="errormsg" style="color: red;display: none"></div>
                </form>
            </div>
            <div class="am-modal-footer">
                <span class="am-modal-btn" data-am-modal-cancel>取消</span>
                <span class="am-modal-btn" onclick="doSubmit('setEmail');" data-am-modal-confirm  id="submit">提交</span>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(function () {
            $('#newemail').on('click',function () {
                $('#my-prompt').modal({
                    relatedTarget:this,
                    closeOnConfirm:false,
                    closeOnCancle:true,
                })
            });
            $('#changeemail').on('click',function () {
                $('#my-prompt1').modal({
                    relatedTarget:this,
                    closeOnConfirm:false,
                    closeOnCancle:true,
                })
            })

        });
        function doSubmit(ele) {
            if (ele != undefined){
                if (ele =='setEmail'){
                    var email = $('#setEmail').val();
                    if (oc.isEmpty(email)){
                        $('#errormsg').html("邮箱不能为空").show();
                        return;
                    };
                    if (!oc.emailValid(email)){
                        $('#errormsg').html("邮箱格式错误").show();
                        return;
                    }
                    $('#setEmailForm').ajaxSubmit({
                        dataType:'json',
                        success:function (resp) {
                            if (resp.errcode==0){
                                $('#errormsg').attr('style','color: green;display: none');
                                $('#errormsg').html("更新成功").show();
                                setTimeout(function(){
                                    window.location.reload();
                                },2000)
                            }
                        },
                        error:function (xhr) {
                            
                        }
                        
                    })
                }
            }
        }
    </script>
</body>